# 工作流名称
name: Download Stock Data

# 触发条件：可以手动触发、push到main分支时触发
on:
  workflow_dispatch:  # 允许手动触发

# 定义要执行的任务
jobs:
  download-and-save:
    # 运行环境：选择Ubuntu最新版
    runs-on: ubuntu-latest

    steps:
      # 1. 检出仓库代码
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. 设置Python环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'  # 指定Python版本，兼容yfinance
          cache: 'pip'  # 缓存pip依赖，加速后续运行

      # 3. 安装依赖（yfinance）
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install yfinance pandas  # yfinance依赖pandas，显式安装更稳定

      # 4. 运行Python脚本生成CSV文件
      - name: Run stock data download script
        run: python download_stock_data.py

      # 5. 上传生成的CSV文件作为构建产物（核心步骤）
      - name: Upload CSV file
        uses: actions/upload-artifact@v4
        with:
          name: stock-price-data  # 产物名称，方便识别
          path: stock_price.csv   # 要上传的文件路径
          retention-days: 30      # 文件保留30天，可按需调整